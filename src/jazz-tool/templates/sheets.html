<!-- Dan Perlman, dmp359@drexel.edu
CS530: DUI, Project -->

{% extends 'base.html' %}
{% set active = "Sheets" %}

{% block title %}
Sheets
{% endblock %}

{% block content %}

<section>
    <div class="content">
        <div class="row flex-grow-1">
            <div style="float: left" class="no-float">
                <div id='sheet-list' class="btn-group-vertical">
                    <!--Generates from api call -->
                </div>
            </div>
            <div style="float:center">
                <div id="pdf-content"></div>
            </div>
            <form action="/api/sheets" method="POST" enctype="multipart/form-data">
                <label for="user_file">Upload Your File</label>
                <br />
                <input type="file" name="user_file">
                <br />
                <button type="submit">Upload</button>
            </form>
        </div>
    </div>
</section>
<script>
    // TODO: Put all this in an external file
    function renderPDF(pdf) {
        const options = {
            pdfOpenParams: { view: 'FitV'}
        };
        PDFObject.embed(pdf,'#pdf-content', options);
    }

// API returns data like:
// [
//   {
//     "description": "Description1", 
//     "name": "Song1", 
//     "object_url": "https://s3.amazonaws.com/user-uploaded-pdfs/dan/pdf1.pdf"
//   }, 
//   {
//     "description": "Description2", 
//     "name": "Song2", 
//     "object_url": "https://s3.amazonaws.com/user-uploaded-pdfs/dan/pdf2.pdf"
//   }
// ]

    // TODO: Remove and replace with some filler div that says "no pdfs"
    let pdf = 'https://www.swiss-jazz.ch/standards-jazz/Spain.pdf';
    $.get("/api/sheets", (data) => {
        if (data) {
            let $songButton, $songText, $songDescription;
            data.forEach((song, i) => {
                $songButton = $('<button>').addClass('btn btn-primary song-button');
                $songText = $('<span>').addClass('song-span');
                $songDescription = $('<span>').addClass('description-span');
                if (i === 0) {
                    $songButton.addClass('active');
                }
                $songText.text(song.name);
                $songDescription.text(song.description);
                $songButton.append($songText);
                $songButton.append($songDescription);
                $songButton.attr('id', song.object_url);
                $songButton.click((c) => {
                    const url = c.currentTarget.id; // Seems hacky
                    // TODO: Highlight currently selected button
                    // $(this).removeClass('active');
                    // $(`#${url}`).addClass('active');
                    renderPDF(url);
                });
                $('#sheet-list').append($songButton);
            });
            pdf = data[0].object_url;
            renderPDF(pdf);
            return;
        }
        
        renderPDF(pdf);
    });

    // const button = <button type="button" style="width: 300px" class="btn btn-primary active">
    //                     <span style="float: left">All the Things You Are</span>
    //                     <span style="float: middle">|</span>
    //                     <span style="float: right">Ballad</span>
    //                 </button>;

    // bikes.forEach(bike => {
    // if (bike.available > 0) {
    //     $rentButton = $('<button>').addClass('btn').text('Rent').attr('id', `button-${bike.id}`);
    //     $rentButton.click(() => {
    //         $(`#${bike.id}`).text(--bike.available)
    //         if (bike.available <= 0) {
    //             $(`#button-${bike.id}`).remove();
    //             $(`#row-${bike.id}`).addClass('unavailable');
    //         }
    //     });
    // }
    // else {
    //     $rentButton = null;
    // }

    // $('button').click(function() {
    //     $('button').addClass('active');
    //     $(this).removeClass('active');
    // });
</script>
{% endblock %}
